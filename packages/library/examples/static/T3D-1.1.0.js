!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).T3D=e()}}(function(){return function(){return function e(t,a,n){function r(o,l){if(!a[o]){if(!t[o]){var s="function"==typeof require&&require;if(!l&&s)return s(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var f=a[o]={exports:{}};t[o][0].call(f.exports,function(e){return r(t[o][1][e]||e)},f,f.exports,e,t,a,n)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}}()({1:[function(e,t,a){const n=e("../util/MathUtils");function r(e){let t={};if(t.version=e.readUint8(),t.magic=e.readString(3),t.headerSize=e.readUint32(),e.seek(e.position+4),t.chunkSize=e.readUint32(),t.crc=e.readUint32(),e.seek(e.position+4),t.mftOffset=n.arr32To64([e.readUint32(),e.readUint32()]),t.mftSize=e.readUint32(),t.flags=e.readUint32(),"AN"===t.magic)return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header"),t;T3D.Logger.log(T3D.Logger.TYPE_ERROR,"ANDat header is not valid",t.magic)}function i(e){let t={};if(t.magic=e.readString(4),e.seek(e.position+8),t.nbOfEntries=e.readUint32(),e.seek(e.position+4+4),"Mft"!==t.magic)return void T3D.Logger.log(T3D.Logger.TYPE_ERROR,"MFTTable header is not valid",t.magic);let a=[];for(let r=1;r<t.nbOfEntries;r++){let t={};t.offset=n.arr32To64([e.readUint32(),e.readUint32()]),t.size=e.readUint32(),t.compressed=e.readUint16(),e.seek(e.position+4+2),t.crc=e.readUint32(),a[r]=t}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded MFTTable"),{header:t,table:a,mftIndexOffset:a[2].offset,mftIndexSize:a[2].size}}function o(e,t){let a=t/8,n=[];for(let t=0;t<a;t++){let t=e.readUint32(),a=e.readUint32();n[t]=a}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT"),n}function l(e,t,a){return new Promise((n,r)=>{let i=new FileReader;i.onerror=r,i.onload=function(e){let t=e.target.result,r=new DataStream(t);r.endianness=DataStream.LITTLE_ENDIAN,n({ds:r,len:a})},i.readAsArrayBuffer(e.slice(t,t+a))})}t.exports={readArchive:async function(e){let t=r((await l(e,0,40)).ds),a=i((await l(e,t.mftOffset,t.mftSize)).ds),{ds:n,len:s}=await l(e,a.mftIndexOffset,a.mftIndexSize),d=o(n,s);return{archiveHeader:t,metaTable:a.table,indexTable:d}},parseANDatHeader:r,parseMFTTable:i,parseMFTIndex:o,getFilePart:l}},{"../util/MathUtils":20}],2:[function(e,t,a){t.exports=class{constructor(e){this._settings=e,this._workerPool=[],this._workerLoad=[],this._inflateCallbacks=[];for(let t=0;t<e.workersNb;t++)this._startWorker(e.workerPath)}inflate(e,t,a,n,r){return new Promise((t,i)=>{let o=e.buffer;if((!r||r<0)&&(r=0),o.byteLength<12)return T3D.Logger.log(T3D.Logger.TYPE_WARNING,`not inflating, length is too short (${o.byteLength})`,a),void i(new Error("Couldn't inflate "+a+" (mftId)"));if(this._inflateCallbacks[a])return void this._inflateCallbacks[a].push({resolve:t,reject:i});this._inflateCallbacks[a]=[{resolve:t,reject:i}];let l=this._getBestWorkerIndex();this._workerLoad[l]+=1,this._workerPool[l].postMessage([a,o,!0===n,r])})}_startWorker(e){let t=this,a=new Worker(e),n=this._workerPool.push(a)-1;if(this._workerLoad.push(0)!==n+1)throw new Error("WorkerLoad and WorkerPool don't have the same length");a.onmessage=function(e){let a;if(t._workerLoad[n]-=1,"string"==typeof e.data){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Inflater threw an error",e.data),a=e.data.split(":")[0];for(let e of t._inflateCallbacks[a])e.reject()}else if(a=e.data[0],t._inflateCallbacks[a]){for(let n of t._inflateCallbacks[a]){let t=e.data;n.resolve({buffer:t[1],dxtType:t[2],imageWidth:t[3],imageHeight:t[4]})}t._inflateCallbacks[a]=null}else T3D.Logger.log(T3D.Logger.TYPE_ERROR,"Inflater threw an error",e.data)}}_getBestWorkerIndex(){return this._workerLoad.indexOf(Math.min(...this._workerLoad))}}},{}],3:[function(e,t,a){const n=e("../format/file/GW2File.js");let r={getFileType:function(e){let t=e.readCString(4);switch(t){case"ATEC":return"TEXTURE_ATEC";case"ATEP":return"TEXTURE_ATEP";case"ATET":return"TEXTURE_ATET";case"ATEU":return"TEXTURE_ATEU";case"ATEX":return"TEXTURE_ATEX";case"ATTX":return"TEXTURE_ATTX"}if(0===t.indexOf("DDS"))return"TEXTURE_DDS";if(1===t.indexOf("PNG"))return"TEXTURE_PNG";if(0===t.indexOf("RIFF"))return"TEXTURE_RIFF";if(0===t.indexOf("YUI"))return"TEXT_YUI";if(0===t.indexOf("PF")){return"PF_"+new n(e,0,!0).header.type}return 0===t.indexOf("MZ")?"BINARIES":0===t.indexOf("strs")?"STRINGS":0===t.indexOf("asnd")?"CHUNK_ASND":"UNKNOWN"}};t.exports=r},{"../format/file/GW2File.js":18}],4:[function(e,t,a){const n=e("./ArchiveParser"),r=e("./PersistantStore"),i=e("./DataReader"),o=e("../MapFileList"),l=e("./FileTypes");t.exports=class{constructor(e){this._settings=e,this._dataReader=new i(e),this._persistantStore,this._file=void 0,this._indexTable=[],this._fileMetaTable=[],!1!==e.noIndexedDB&&(this._persistantStore=new r)}async openArchive(e){let{metaTable:t,indexTable:a}=await n.readArchive(e);this._fileMetaTable=t,this._indexTable=a,this._file=e}getFileIndex(e){return this._indexTable[e]}getFileMeta(e){return this._fileMetaTable[e]}async readFile(e,t,a,r,i){let o=this.getFileMeta(e);if(!o)throw new Error("Unexistant file");let{ds:l,len:s}=await n.getFilePart(this._file,o.offset,r||o.size);if(o.compressed||!1!==a){let a;return await this._dataReader.inflate(l,s,e,t,i||0).then(e=>{a=e}).catch(()=>{a={buffer:void 0,dxtType:void 0,imageWidth:void 0,imageHeight:void 0}}),a}return{buffer:l.buffer}}async readFileList(e){let t,a=this,n=e||[];if(this._persistantStore){let e=await this._persistantStore.getLastListing(this._file.name);n=e.array,e.complete||(t=e.key)}let r=Object.keys(a._indexTable).map(e=>Number(e));for(let e in n)e in a._indexTable||r.push(e);let i=[];for(let e=0;e<1;e++)i[e]=Promise.resolve({task:e});let o=!1;for(let e in r){let l=r[e],s=this._needsScan(l,n);if(!0===s.scan){let e=(await Promise.race(i)).task;i[e]=this._readFileType(l).then(t=>(n[l]={baseId:l,size:t.size,crc:t.crc,fileType:t.fileType},{task:e}))}"removed"===s.change&&delete n[l],"none"!==s.change&&(o=!0),e%Math.floor(r.length/100)==0&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Finding types",e/Math.floor(r.length/100)),a._persistantStore&&o&&(o=!1,a._persistantStore.putListing(t,n,a._file.name,!1).then(e=>t=e)))}return await Promise.all(i).then(()=>{a._persistantStore&&a._persistantStore.putListing(t,n,a._file.name,!0)}),this._persistantData=n,this.getFileList()}getMapList(){let e=this,t=[];if(this._persistantData){let a=this.getReverseIndex(),n=this._persistantData.filter(e=>"PF_mapc"===e.fileType).filter(t=>t.baseId===a[e.getFileIndex(t.baseId)][0]);for(let e of n){let a=!1;for(let n of o.maps){let r=n.maps.find(t=>Number(t.fileName.split(".data")[0])===e.baseId);if(r){t.push({name:r.name,category:n.name,baseId:e.baseId}),a=!0;break}}a||t.push({name:e.baseId.toString(),category:"Uncategorized",baseId:e.baseId})}}else for(let e of o.maps)for(let a of e.maps)Number(a.fileName.split(".data")[0])in this._indexTable&&t.push({name:a.name,category:e.name,baseId:Number(a.fileName.split(".data")[0])});return t}getFileList(){let e=this._persistantData?this._persistantData.map(e=>e.fileType):[],t=this.getReverseIndex(),a=this._fileMetaTable.map((a,n)=>{let r=t[n]?t[n]:[],i=t[n]?e[r[0]]:"Non-Registered";return{mftId:n,baseIdList:r,size:a.size,crc:a.crc,fileType:i}});return a[0]={mftId:0,baseIdList:[],size:0,crc:0,fileType:"Non-Registered"},a}getReverseIndex(){return this._indexTable.reduce((e,t,a)=>(t in e?e[t].push(a):e[t]=[a],e),[])}readMapListAsync(e,t){let a=this;function n(e){let t=[];for(let a of e){let e=t.findIndex(e=>e.name===a.category);-1===e&&(e=t.push({name:a.category,maps:[]})-1),t[e].maps.push({fileName:a.baseId,name:a.name})}return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),{maps:t}}T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readMapListAsync is deprecated !"),e?this.readFileList().then(()=>{t(n(a.getMapList()))}):t(n(a.getMapList()))}readFileListAsync(e){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readFileListAsync is deprecated !"),this.readFileList().then(t=>{let a={};for(let e of t)void 0===a[e.fileType]&&(a[e.fileType]=[]),a[e.fileType].push(e.mftId);e(a)})}loadFile(e,t,a,n){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFile is deprecated !");let r=this.getFileIndex(e);if(r<=0)return t(null);this.readFile(r,a,n).then(e=>{if(void 0===e.buffer)return t(null);t(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadTextureFile(e,t){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadTextureFile is deprecated !"),this.loadFile(e,t,!0)}loadFileList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFileList is deprecated !")}loadMapList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadMapList is deprecated !")}_needsScan(e,t){if(e<=0)return{change:"none",scan:!1};let a=this.getFileIndex(e),n=this.getFileMeta(a);return void 0!==n||e in t?void 0===n?{change:"removed",scan:!1}:e in t?n.size!==t[e].size||n.crc!==t[e].crc?{change:"modified",scan:!0}:{change:"none",scan:!1}:{change:"added",scan:!0}:{change:"none",scan:!1}}async _readFileType(e){this._fileTypeCache||(this._fileTypeCache=[]);let t,a=this.getFileIndex(e),n=this.getFileMeta(a);if(void 0!==this._fileTypeCache[e])t=this._fileTypeCache[e];else{let e=(await this.readFile(a,!1,!1,Math.min(n.size,1e3),32)).buffer;if(void 0===e)return;t=l.getFileType(new DataStream(e))}return{fileType:t,crc:n.crc,size:n.size}}}},{"../MapFileList":7,"./ArchiveParser":1,"./DataReader":2,"./FileTypes":3,"./PersistantStore":5}],5:[function(e,t,a){const n=4;t.exports=class{constructor(){this._dbConnection=void 0,this._getConnection(()=>{})}_getConnection(){let e=this;return new Promise((t,a)=>{e._dbConnection&&t(e._dbConnection);let r=window.indexedDB.open("Tyria3DLibrary",n);r.onblocked=(()=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database cannot be upgraded while the app is opened somewhere else.")}),r.onupgradeneeded=(e=>{let t=e.target.result,a=e.oldVersion;a<2&&t.createObjectStore("listings",{autoIncrement:!0}),a<3&&e.currentTarget.transaction.objectStore("listings").createIndex("filename","filename",{unique:!1})}),r.onsuccess=(a=>{e._dbConnection=a.target.result,e.isReady=!0,t(e._dbConnection)}),r.onerror=(()=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database could not be opened."),a()})})}putListing(e,t,a,n){let r=this;return new Promise((i,o)=>{r._getConnection().then(r=>{let l=r.transaction(["listings"],"readwrite").objectStore("listings"),s=e?l.put({array:t,filename:a,complete:n},e):l.put({array:t,name:a});s.onsuccess=(()=>{i(s.result)}),s.onerror=(()=>{o()})})})}getLastListing(e){let t=this;return new Promise(a=>{t._getConnection().then(t=>{t.transaction(["listings"],"readonly").objectStore("listings").index("filename").openCursor(IDBKeyRange.only(e),"prev").onsuccess=(e=>{let t=e.target.result;a(t?{array:t.value.array,key:t.primaryKey,complete:t.value.complete}:{array:[],key:void 0,complete:!0})})})})}}},{}],6:[function(e,t,a){let n={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};n.logFunctions=new Array(5),n.log=function(){if(0===arguments.length)return;let e=n.argsToArr(arguments);1===e.length&&e.unshift(n.TYPE_MESSAGE);let t=Math.max(0,Math.min(n.logFunctions.length,e.shift()));n.logFunctions[t].apply(this,e)},n.argsToArr=function(e){let t=new Array(e.length);for(let a=0;a<t.length;++a)t[a]=e[a];return t},n.logFunctions[n.TYPE_ERROR]=function(){console.error.apply(console,arguments)},n.logFunctions[n.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},n.logFunctions[n.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},n.logFunctions[n.TYPE_PROGRESS]=function(){let e=n.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},n.logFunctions[n.TYPE_DEBUG]=function(){let e=n.argsToArr(arguments);console.debug.apply(console,e)},t.exports=n},{}],7:[function(e,t,a){t.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"1966018.data",name:"Hoelbrak (2)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"1968107.data",name:"Black Citadel (2)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"1968576.data",name:"Lion's Arch (4)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"1968748.data",name:"Divinity's Reach (3)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove (0)"},{fileName:"1969341.data",name:"The Grove (1)"},{fileName:"198272.data",name:"Rata Sum (0)"},{fileName:"1968896.data",name:"Rata Sum (1)"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],8:[function(e,t,a){(function(a){let n,r=e("./LocalReader/LocalReader"),i={t3dtoolsWorker:"modules/t3dtools/t3dworker.js",concurrentTasks:"undefined"!=typeof navigator?navigator.hardwareConcurrency:1};n=t.exports={version:"1.1.0",GW2File:e("./format/file/GW2File"),GW2Chunk:e("./format/file/GW2Chunk"),DataRenderer:e("./dataRenderer/DataRenderer"),EnvironmentRenderer:e("./dataRenderer/EnvironmentRenderer"),HavokRenderer:e("./dataRenderer/HavokRenderer"),PropertiesRenderer:e("./dataRenderer/PropertiesRenderer"),SingleModelRenderer:e("./dataRenderer/SingleModelRenderer"),TerrainRenderer:e("./dataRenderer/TerrainRenderer"),ZoneRenderer:e("./dataRenderer/ZoneRenderer"),StringRenderer:e("./dataRenderer/StringRenderer"),Logger:e("./Logger"),MapFileList:e("./MapFileList"),MaterialUtils:e("./util/MaterialUtils.js"),MathUtils:e("./util/MathUtils.js"),ParserUtils:e("./util/ParserUtils.js"),RenderUtils:e("./util/RenderUtils.js"),PersistantStore:e("./LocalReader/PersistantStore"),FileTypes:e("./LocalReader/FileTypes"),getLocalReader:function(e,t,a){let n=new r({workerPath:a||i.t3dtoolsWorker,workersNb:i.concurrentTasks});return n.openArchive(e).then(()=>{t(n)}),n},getFileListAsync:function(e,t){let a=e.loadFileList();a?t(a):e.readFileListAsync(t)},getMapListAsync:function(e,t,a){if(a)return void e.readMapListAsync(!0,t);let n=e.loadMapList();n?t(n):e.readMapListAsync(!1,t)},renderMapContentsAsync:function(e,t,a,r,i){let o,l={};if(parseInt(t))e.loadFile(t,function(t){let i=new DataStream(t,0,DataStream.LITTLE_ENDIAN),s=new n.GW2File(i,0);(o=function(t){t<a.length?n.runRenderer(a[t].renderClass,e,Object.assign(a[t].settings,{mapFile:s}),l,o.bind(this,t+1)):r(l)})(0)});else{(i||n.Logger).log(n.Logger.TYPE_ERROR,"Map id must be an integer!, was:",t)}},runRenderer:function(e,t,a,n,r){new e(t,a,n).renderAsync(r)},getContextValue:function(e,t,a,n){let r=e[t.name];return r&&r[a]?r[a]:n},hasWebGL:function(e){if(window.WebGLRenderingContext){let t=document.createElement("canvas"),a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1;for(let r=0;r<4;r++)try{if((n=t.getContext(a[r]))&&"function"==typeof n.getParameter)return!e||{name:a[r],gl:n}}catch(e){}return!1}return!1}},function(){let e=0;a.window&&window.indexedDB||(n.Logger.log(n.Logger.TYPE_ERROR,"T3D persistant storing and loading requires indexedDB support."),e++),"undefined"==typeof DataStream&&(n.Logger.log(n.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),e++),"undefined"==typeof THREE&&(n.Logger.log(n.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),e++),e<1&&n.Logger.log(n.Logger.TYPE_MESSAGE,"Tyria 3D API v"+n.version+" initialized.")}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LocalReader/FileTypes":3,"./LocalReader/LocalReader":4,"./LocalReader/PersistantStore":5,"./Logger":6,"./MapFileList":7,"./dataRenderer/DataRenderer":9,"./dataRenderer/EnvironmentRenderer":10,"./dataRenderer/HavokRenderer":11,"./dataRenderer/PropertiesRenderer":12,"./dataRenderer/SingleModelRenderer":13,"./dataRenderer/StringRenderer":14,"./dataRenderer/TerrainRenderer":15,"./dataRenderer/ZoneRenderer":16,"./format/file/GW2Chunk":17,"./format/file/GW2File":18,"./util/MaterialUtils.js":19,"./util/MathUtils.js":20,"./util/ParserUtils.js":21,"./util/RenderUtils.js":22}],9:[function(e,t,a){const n=e("../format/file/GW2File");let r=function(e,t,a,n){this.localReader=e,this.settings=t,t||(t={}),this.context=a,this.context[this.constructor.name]={},this.logger=n||T3D.Logger};r.prototype.getOutput=function(e){return this.context[e?e.name:this.constructor.name]},r.prototype.renderAsync=function(e){let t=this;this.localReader.loadFile(this.settings.id,function(a){t.getOutput().fileId=t.settings.id,t.getOutput().rawData=a;let r=new Uint8Array(a),i=[],o=Math.min(r.length,1e4);for(let e=0;65535*e<o;e++)i.push(String.fromCharCode.apply(null,r.subarray(65535*e,65535*(e+1))));o<r.length&&i.push("T3D Ignored the last "+(r.length-o)+" bytes when generating this raw output"),t.getOutput().rawString=i.join();let l=new DataStream(a),s=l.readCString(4);"ATEX"===s||"ATEC"===s||"ATEP"===s||"ATET"===s||"ATEU"===s||"ATTX"===s?t.localReader.loadTextureFile(t.settings.id,function(a,n,r,i){let o={data:new Uint8Array(a),width:r,height:i};t.getOutput().image=o,e()}):0===s.indexOf("PF")?(t.getOutput().file=new n(l,0),e()):(t.getOutput().file=null,e())})},t.exports=r},{"../format/file/GW2File":18}],10:[function(e,t,a){const n=e("../util/RenderUtils"),r=e("./DataRenderer");function i(e,t,a,i){r.call(this,e,t,a,i),this.mapFile=this.settings.mapFile,this.getMat=function(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})},this.loadTextureWithFallback=function(t,a,r,i,o){let l=this;function s(e){t.forEach(function(t){a[t]=e})}function d(){s(l.getMat((new THREE.TextureLoader).load(i)))}s(l.getMat(n.loadLocalTexture(e,r,null,o,function(){setTimeout(d,1)})))},this.getHazeColor=function(e){let t=e&&e.dataGlobal.haze;return!t||t.length<=0?[190,160,60]:t[0].farColor},this.parseLights=function(e){let t=this;t.getOutput().lights=[];let a,n=e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}],r=!1;n.forEach(function(e){if(r)return;let n=0;if(e.lights.forEach(function(e){r=!0;let a=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),i=new THREE.DirectionalLight(a.getHex(),e.intensity);i.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),n+=e.intensity,t.getOutput().lights.push(i)}),!e.lights||0===e.lights.length){[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]].forEach(function(e){let a=new THREE.Color(1,1,1),r=e[3],i=new THREE.DirectionalLight(a.getHex(),r);i.position.set(e[0],e[1],e[2]).normalize(),n+=r,t.getOutput().lights.push(i)})}let i=new THREE.Color(e.backlightIntensity*(255-e.backlightColor[2])/255,e.backlightIntensity*(255-e.backlightColor[1])/255,e.backlightIntensity*(255-e.backlightColor[0])/255);a=new THREE.AmbientLight(i)});let i=0;a&&(i=a.color.r+a.color.g+a.color.b,this.getOutput().lights.push(a)),this.getOutput().hasLight=r||i>0},this.parseSkybox=function(e,t,a){this.getOutput().skyElements=[];let n=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];n||(n={texPathNE:1930687,texPathSW:193069,texPathT:193071});let r=t.rect,i=Math.abs(r.x1-r.x2),o=Math.abs(r.y1-r.y2),l=(Math.max(i,o),[]);this.loadTextureWithFallback([1,4],l,n.texPathNE+1,"img/193068.png",a),this.loadTextureWithFallback([0,5],l,n.texPathSW+1,"img/193070.png",a),this.loadTextureWithFallback([2],l,n.texPathT+1,"img/193072.png",a),l[3]=new THREE.MeshBasicMaterial({visible:!1});let s=new THREE.BoxGeometry(1024,512,1024);s.faceVertexUvs[0].forEach(function(e,t){let a=Math.floor(t/2);0===a||1===a?e.forEach(function(e){e.x=1-e.x,e.y/=2,e.y+=.5}):5===a||4===a?e.forEach(function(e){e.y/=-2,e.y+=.5}):e.forEach(function(e){e.x=1-e.x})}),s.uvsNeedUpdate=!0;let d=new THREE.Mesh(s,l);d.translateY(256),this.getOutput().skyElements.push(d)}}i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){let t=this.mapFile.getChunk("env").data,a=this.mapFile.getChunk("parm").data,n=this.getHazeColor(t),r=256*n[2]*256+256*n[1]+n[0];this.getOutput().hazeColor=n,this.parseLights(t),this.parseSkybox(t,a,r),e()},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],11:[function(e,t,a){const n=e("./DataRenderer");function r(e,t,a,r){n.call(this,e,t,a,r),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,t,a){let n;n=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,n,t,200,0,a)},this.getCollisionsForAnimation=function(e,t){let a=[];for(let n=0;n<e.collisionIndices.length;n++){let r=e.collisionIndices[n],i=t[r];i.index=r,a.push(i)}return a},this.parseAllModels=function(e,t,a,n,r,i){let o=r;for(;o<r+n&&o<e.length;o++){let n=Math.round(100*o/e.length);n!==this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+a+")",n),this.lastP=n);let r=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),i=this.getCollisionsForAnimation(r,this.havokChunkData.collisions);for(let a=0;a<i.length;a++){let n=i[a];this.renderMesh(n,e[o],t)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,t,a,n,r+n,i),10):i()},this.animationFromGeomIndex=function(e,t,a){let n=t[e].animations.length;return a[t[e].animations[n-1]]},this.renderMesh=function(e,t,a){let n=t.translate,r=t.rotate,i=32*t.scale,o=this.parseHavokMesh(e,a);o.position.set(n[0],-n[2],-n[1]),i&&o.scale.set(i,i,i),r&&(o.rotation.order="ZXY",o.rotation.set(r[0],-r[2],-r[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){let e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,t){let a=e.index;if(this.meshes[a])return this.meshes[a].clone();{let n=new THREE.Geometry;for(let t=0;t<e.vertices.length;t++){let a=e.vertices[t];n.vertices.push(new THREE.Vector3(a[0],a[2],-a[1]))}for(let t=0;t<e.indices.length;t+=3){let a=e.indices[t],r=e.indices[t+1],i=e.indices[t+2];a<=e.vertices.length&&r<=e.vertices.length&&i<=e.vertices.length?n.faces.push(new THREE.Face3(a,r,i)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return n.computeFaceNormals(),this.meshes[a]=new THREE.Mesh(n,t),this.meshes[a]}}}r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.renderAsync=function(e){let t=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];let a=this.havokChunkData.propModels,n=this.havokChunkData.zoneModels,r=this.havokChunkData.obsModels;r.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;let i=function(){t.renderModels(r,"obs",e)};t.renderModels(a,"prop",function(){t.renderModels(n,"zone",i)})},t.exports=r},{"./DataRenderer":9}],12:[function(e,t,a){const n=e("../util/RenderUtils"),r=e("./DataRenderer");function i(e,t,a,n){r.call(this,e,t,a,n),this.mapFile=this.settings.mapFile}i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){let t=this;t.getOutput().meshes=[];let a=this.mapFile.getChunk("prp2").data;if(!a)return void e();let r=a.propArray,i=a.propAnimArray,o=a.propInstanceArray,l=a.propMetaArray;r=r.concat(i).concat(o).concat(l),t.meshCache={},t.textureCache={};let s=-1,d=function(a){if(a>=r.length)return t.meshCache={},t.textureCache={},void e();let i=Math.round(1e3*a/r.length);if(s!==(i/=10)){let e=i+(i.toString().indexOf(".")<0?".0":"");t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",e),s=i}let o=r[a],l=function(e,t,a,n,r){let i=0!==n.lod2?n.lod2:e.lodOverride[1];if(0===e.flags&&(i=0),r&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,t[i])t[i].add(e);else{let n=new THREE.Group;n.updateMatrix(),n.matrixAutoUpdate=!1,n.add(e),t[i]=n,a.addLevel(n,i)}return i};n.getMeshesForFilename(o.filename,o.color,t.localReader,t.meshCache,t.textureCache,!1,function(e,n,r){e&&function(e,a,n){let r={},i=new THREE.LOD,s=0;e.forEach(function(e){s=Math.max(s,l(e,r,i,o,a))}),i.addLevel(new THREE.Group,1e5),o.rotation&&(i.rotation.order="ZXY",i.rotation.set(o.rotation[0],-o.rotation[2],-o.rotation[1])),i.scale.set(o.scale,o.scale,o.scale),i.position.set(o.position[0],-o.position[2],-o.position[1]),i.boundingSphereRadius=(n&&n.radius?n.radius:1)*o.scale,i.updateMatrix(),i.matrixAutoUpdate=!1,t.getOutput().meshes.push(i),o.transforms&&o.transforms.forEach(function(a){let r={},i=new THREE.LOD,s=0;e.forEach(function(e){s=Math.max(s,l(e,r,i,o,!0))}),a.rotation&&(i.rotation.order="ZXY",i.rotation.set(a.rotation[0],-a.rotation[2],-a.rotation[1])),i.scale.set(a.scale,a.scale,a.scale),i.position.set(a.position[0],-a.position[2],-a.position[1]),i.updateMatrix(),i.matrixAutoUpdate=!1,i.boundingSphereRadius=(n&&n.radius?n.radius:1)*o.scale,i.update(i),t.getOutput().meshes.push(i)})}(e,n,r),d(a+1)})};d(0)},i.prototype.getFileIdsAsync=function(e){let t=[],a=this.mapFile.getChunk("prp2").data,r=a.propArray,i=a.propAnimArray,o=a.propInstanceArray,l=a.propMetaArray;r=r.concat(i).concat(o).concat(l);let s=function(a){if(a>=r.length)return void e(t);a%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",a,"of",r.length);let i=r[a];n.getFilesUsedByModel(i.filename,{},function(e){t=t.concat(e),s(a+1)})};s(0)},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],13:[function(e,t,a){const n=e("../util/RenderUtils"),r=e("./DataRenderer");function i(e,t,a,n){r.call(this,e,t,a,n)}i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){let t=this,a=this.settings.id,r={};t.getOutput().meshes=[],n.getMeshesForFilename(a,65280,t.localReader,r,{},!0,function(a,n,i){a&&a.forEach(function(e){e.boundingSphere=i,t.getOutput().meshes.push(e)}),r={},e()})},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],14:[function(e,t,a){const n=e("./DataRenderer");function r(e,t,a,r){n.call(this,e,t,a,r)}r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.renderAsync=function(e){let t=this;this.settings.id;this.getOutput().strings=[],this.localReader.loadFile(this.settings.id,function(a){let n=new DataStream(a),r=n.byteLength-2;n.seek(4);let i=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],o=0;for(;r-n.position>6;){let e=n.readStruct(i);if(e.size-=6,e.size>0){if(!(0!==e.decryptionOffset||16!==e.bitsPerSymbol)){let a=n.readUCS2String(e.size/2);t.getOutput().strings.push({value:a,recid:o})}}o++}n.seek(n.byteLength-2),t.getOutput().language=n.readUint16(),e()})},t.exports=r},{"./DataRenderer":9}],15:[function(e,t,a){const n=e("../util/RenderUtils"),r=e("./DataRenderer"),i=e("../format/file/GW2File.js"),o=e("../util/TerrainShader.js");function l(e,t,a,l,s){r.call(this,e,t,a,l,s),this.mapFile=this.settings.mapFile,this.drawWater=function(e){let t=t||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return t.transparent=!0,n.renderRect(e,0,t)},this.parseNumChunks=function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1},this.loadPagedImageCallback=function(e,t){let a=this;a.getOutput().terrainTiles=[];let r=new DataStream(t),l=new i(r,0).getChunk("pgtb"),s=l&&l.data;this.mapRect=null;let d=this.mapFile.getChunk("trn").data,f=this.mapFile.getChunk("parm").data,m=this.settings.anisotropy?this.settings.anisotropy:1;this.parseNumChunks(d);let u=d.numChunksD_1,h=d.numChunksD_2,c=d.materials.materials,g=d.materials.texFileArray,p=f.rect[2]-f.rect[0],T=f.rect[3]-f.rect[1],E=p/d.numChunksD_1*1,R=T/d.numChunksD_2*1,y=0,N=[],x=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),v={};if(s){s.strippedPages.forEach(function(e){if(e.layer<=1){let t=e.filename,r=e.coord,i=r[0]+","+r[1];if(1===e.layer&&(i+="-2"),!v[i]){let e=n.loadLocalTexture(a.localReader,t);e&&(e.anisotropy=m,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping),v[i]=e}}})}let M=function(t,r){if(t>=u&&(t=0,r++),r>=h)return a.getOutput().water=a.drawWater(a.mapRect),a.getOutput().bounds=a.mapRect,void e();let i=Math.floor(100*(r*u+t)/(u*h));a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",i),function(e,t){let r=t*u+e,i=Math.floor(e/4),l=Math.floor(t/4),s=c[r].loResMaterial.texIndexArray,h=x,p=e%4/4,T=.75-t%4/4,M=[];for(let e=0;e<s.length/2;e++){let t=g[s[e]].filename;if(M.push(t),!v[t]){let e=n.loadLocalTexture(a.localReader,t);e&&(e.anisotropy=m,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping),v[t]=e}}let k=i+","+l,b=i+","+l+"-2",w={color:{r:1,g:1,b:1},near:0,far:0},F=a.getOutput(T3D.EnvironmentRenderer);F.hazeColor&&(w.color.r=F.hazeColor[2]/255,w.color.g=F.hazeColor[1]/255,w.color.b=F.hazeColor[0]/255);let D=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);D.uvScale={type:"v2",value:new THREE.Vector2(8,8)},D.offset={type:"v2",value:new THREE.Vector2(p,T)},D.texturePicker={type:"t",value:v[k]},D.texturePicker2={type:"t",value:v[b]},D.texture1={type:"t",value:v[M[0]]},D.texture2={type:"t",value:v[M[1]]},D.texture3={type:"t",value:v[M[2]]},D.texture4={type:"t",value:v[M[3]]},h=new THREE.ShaderMaterial({uniforms:D,fragmentShader:o.getFragmentShader(),vertexShader:o.getVertexShader()}),N.push(h);let S=new THREE.PlaneBufferGeometry(E,R,32,32),L=0;for(let e=0;e<35;e++)for(let t=0;t<35;t++)0!==t&&34!==t&&0!==e&&34!==e&&(S.getAttribute("position").array[3*L+2]=d.heightMapArray[y],L++),y++;let A,C=(new THREE.Matrix4).identity();C.elements[5]=-1,S.applyMatrix(C),S.computeFaceNormals(),A=new THREE.Mesh(S,x),(A=h.length?THREE.SceneUtils.createMultiMaterialObject(S,h):new THREE.Mesh(S,h)).rotation.set(Math.PI/2,0,0);let P=f.rect[0]+E/2,_=e*E;if(A.position.x=P+_,d.numChunksD_2%2==0){let e=f.rect[1]+R/2-0,a=t*R*1;A.position.z=a+e}else{let e=f.rect[1]-R/2+0,a=t*R*1;A.position.z=e+a}let U=A.position.x,H=A.position.z;a.mapRect||(a.mapRect={x1:U-E/2,x2:U+E/2,y1:H-R/2,y2:H+R/2}),a.mapRect.x1=Math.min(a.mapRect.x1,U-E/2),a.mapRect.x2=Math.max(a.mapRect.x2,U+E/2),a.mapRect.y1=Math.min(a.mapRect.y1,H-R/2),a.mapRect.y2=Math.max(a.mapRect.y2,H+R/2),A.updateMatrix(),A.updateMatrixWorld(),a.getOutput().terrainTiles.push(A)}(t,r),setTimeout(M,1,t+1,r)};M(0,0)}}l.prototype=Object.create(r.prototype),l.prototype.constructor=l,l.prototype.renderAsync=function(e){let t=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.loadFile(t,this.loadPagedImageCallback.bind(this,e))},l.prototype.getFileIdsAsync=function(){let e=this.mapFile.getChunk("trn"),t=this.mapFile.getChunk("pimg"),a=[];return(t&&t.data).strippedPages.forEach(function(e){e.layer<=1&&e.filename>0&&a.push(e.filename)}),e.data.materials.texFileArray.forEach(function(e){e.filename>0&&a.push(e.filename)}),a},t.exports=l},{"../format/file/GW2File.js":18,"../util/RenderUtils":22,"../util/TerrainShader.js":23,"./DataRenderer":9}],16:[function(e,t,a){const n=e("../util/RenderUtils"),r=e("./DataRenderer");function i(e,t,a,i){r.call(this,e,t,a,i),this.mapFile=this.settings.mapFile,this.renderZone=function(e,t,a,r){let i=this,o=null;t.forEach(function(t){o||t.token!==e.defToken||(o=t)});let l=this.getModelGroups(e,o,a);i.meshCache={},i.textureCache={};let s=Object.keys(l);!function e(t){if(t>=s.length)return i.meshCache={},i.textureCache={},void r();let a=s[t],o=l[a],d=[];n.getMeshesForFilename(a,null,i.localReader,i.meshCache,i.textureCache,!1,function(a){a&&o.forEach(function(e,t){a.forEach(function(a,n){if(525===a.materialFlags)return;let r={x:0,y:0,z:0};if(d[n])r.x=e.x-d[n].position.x,r.y=e.z-d[n].position.z,r.z=e.y-d[n].position.y;else{let t=a.geometry.clone();d[n]={readVerts:t.getAttribute("position").array,verts:new Float32Array(o.length*t.getAttribute("position").array.length),readIndices:t.getIndex().array,indices:new Uint32Array(o.length*t.getIndex().array.length),readUVs:t.getAttribute("uv").array,uvs:new Float32Array(o.length*t.getAttribute("uv").array.length),readNormals:t.getAttribute("normal").array,normals:new Float32Array(o.length*t.getAttribute("normal").array.length),material:a.material,position:{x:e.x,y:e.y,z:e.z}}}let i=d[n].readVerts,l=d[n].verts,s=i.length;for(let e=0,a=t*s;e<s;e+=3,a+=3)l[a+0]=i[e+0]+r.x,l[a+1]=i[e+1]+r.y,l[a+2]=i[e+2]+r.z;let f=d[n].readIndices,m=d[n].indices,u=f.length,h=s*t/3;for(let e=0,a=t*u;e<u;e++,a++)m[a]=f[e]+h;let c=d[n].readUVs,g=d[n].uvs,p=c.length;for(let e=0,a=t*p;e<p;e++,a++)g[a]=c[e];let T=d[n].readNormals,E=d[n].normals,R=T.length;for(let e=0,a=t*R;e<R;e++,a++)E[a]=T[e]})}),d.forEach(function(e){let t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),t.setIndex(new THREE.BufferAttribute(e.indices,1)),t.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),t.buffersNeedUpdate=!0;let a=new THREE.Mesh(t,e.material);a.position.set(e.position.x,e.position.z,e.position.y),i.getOutput().meshes.push(a)}),e(t+1)})}(0)},this.getModelGroups=function(e,t,a){let n=a[0],r=a[1],i=48,o=e.vertRect[0]*i+n,l=(e.vertRect[2],e.vertRect[1]*-i-r);e.vertRect[3];if(0===e.encodeData.length)return{};let s=e.vertRect[0]-e.vertRect[2],d=0,f={},m=this.getOutput(T3D.TerrainRenderer).terrainTiles;for(let a=0;a<e.flags.length;a+=2){d+=e.flags[a];let n=e.flags[a+1];if(0!==n){let e=n>>4,a=t.layerDefArray[e-1];if(a){let e=d%s*i+o,t=Math.floor(d/s)*i+l,n=null,r=1e5,u=new THREE.Raycaster(new THREE.Vector3(e,r,t),new THREE.Vector3(0,-1,0));m.forEach(function(e){if(null===n){let t=u.intersectObject(e);t.length>0&&(n=r-t[0].distance)}});let h=0,c=a.modelArray[h].filename,g=a.rotRangeX,p=a.rotRangeY,T=a.rotRangeZ,E=a.scaleRange,R=a.fadeRange;f[c]||(f[c]=[]),f[c].push({x:e,y:t,z:n,rotRangeX:g,rotRangeY:p,rotRangeZ:T,scaleRange:E,fadeRange:R})}}}return f}}i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){let t=this;t.getOutput().meshes=[];let a=this.mapFile.getChunk("zon2").data,n=this.mapFile.getChunk("parm").data.rect,r=a.zoneArray,i=a.zoneDefArray,o=-1;!function a(l){let s=Math.round(100*l/r.length);o!==s&&(t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",s),o=s),l>=r.length?e():t.renderZone(r[l],i,n,a.bind(t,l+1))}(0)},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],17:[function(e,t,a){const n=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"];let r;const i=[{pack:"MODL",chunk:"ANIM",root:"ModelFileAnimation"},{pack:"MODL",chunk:"GAME",root:"ModelFileGame"},{pack:"MODL",chunk:"SKEL",root:"ModelFileSkeleton"},{pack:"MODL",chunk:"TOOL",root:"ModelFileTool"},{pack:"cntc",chunk:"Main",root:"PackContent"},{pack:"mMet",chunk:"Main",root:"PackMapMetadata"},{pack:"AMAT",chunk:"TOOL",root:"AmatToolParams"},{pack:"cmaC",chunk:"main",root:"CollideModelManifest"}];class o{constructor(e,t){!function(){if(!r){r={};for(let t of i){let a=new RegExp(`^${t.root}(V[0-9]*)?$`),n=T3D.formats.filter(e=>e.name===t.chunk);for(let i in n){let o=n[i].versions;if(e(o[Object.keys(o).pop()]).match(a)){r[t.chunk]||(r[t.chunk]=[]),r[t.chunk][i]=t.pack;break}}}}function e(e){let t=new e;return Object.keys(t).filter(e=>t[e]===t.__root&&"__root"!==e)[0]}}(),this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.loadHead()}loadHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr}getDefinition(e){let t=0,a=r[this.header.type];if(a){t=-1;for(let n=0;n<a.length&&-1===t;n++){a[n]===e&&(t=n)}if(-1===t)throw new Error("We didnt find this file name!")}let n=0;for(let e=0;e<T3D.formats.length;e++){let a=T3D.formats[e];if(a.name===this.header.type){if(n===t&&a.versions[this.header.chunkVersion])return(new a.versions[this.header.chunkVersion]).__root;n++}}}loadData(e){let t=this.getDefinition(e);t?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(t)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)}next(){try{return new o(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null}}t.exports=o},{}],18:[function(e,t,a){const n=e("./GW2Chunk"),r=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"];t.exports=class{constructor(e,t,a){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),a||this.readChunks()}readHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr}readChunks(){this.chunks=[];let e=new n(this.ds,this.headerLength+this.addr);for(;null!==e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()}getChunk(e){for(let t=0;t<this.chunks.length;t++)if(this.chunks[t].header.type.toLowerCase()===e.toLowerCase())return this.chunks[t];return null}getChunkStructs(){return{}}}},{"./GW2Chunk":17}],19:[function(e,t,a){function n(e){let t="",a="",n="";for(let r=0;r<e;r++)t+="varying vec2 vUv_"+(r+1)+";\n",r>1&&(a+="attribute vec2 uv"+(r+1)+";\n"),n+="vUv_"+(r+1)+" = uv"+(r>0?r+1:"")+";\n";return a+t+"void main()\n{\n"+n+"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"}function r(e,t,a){let n=e*t,r=new Uint8Array(4*n),i=Math.floor(255*a.r),o=Math.floor(255*a.g),l=Math.floor(255*a.b);for(let e=0;e<n;e++){let t=4*e;r[t]=i,r[t+1]=o,r[t+2]=l,r[t+3]=255}return new THREE.DataTexture(r,e,t,THREE.RGBAFormat)}function i(e,t,a,n){let r="vUv_"+(e[0].uvIdx+1),i="";a&&(i="    if (c1.a < 0.5) \n       discard;\n");let o="gl_FragColor = c1;\n";if(n){o="   vec4 c2 = texture2D( texture"+(0+1)+", "+"vUv_1"+" );\n     gl_FragColor = c2;\n"}let l="";e.forEach(function(e,t){l+="uniform sampler2D texture"+(t+1)+";\n"});let s="";for(let e=0;e<t;e++)s+="varying vec2 vUv_"+(e+1)+";\n";return l+s+"void main( void ) {\n    vec4 c1 = texture2D( texture1, "+r+" );\n"+i+o+"}"}function o(e,t,a){let r=!1,o={};e.forEach(function(e,t){o["texture"+t]={type:"t",value:e}}),e.length>1&&(r=!0);let l={};for(let e=2;e<t;e++)l["uv"+(e+1)]={type:"v2",value:[]};let s=n(t);return new THREE.ShaderMaterial({uniforms:o,vertexShader:s,fragmentShader:i(e,t,a,r),attributes:l,side:THREE.FrontSide})}function l(e,t,a){let n;return e&&a[e]?n=a[e]:e&&((n=s(t,e)).wrapT=THREE.RepeatWrapping,n.wrapS=THREE.RepeatWrapping,n.flipY=!1,a[e]=n),n}function s(e,t,a,n,i){void 0===n&&(n=Math.floor(16777215*Math.random()));let o=r(1,1,new THREE.Color(n));return o.minFilter=THREE.LinearMipMapLinearFilter,o.magFilter=THREE.LinearFilter,o.generateMipmaps=!0,o.flipY=!0,parseInt(t)<=0?(i&&i(),o):(e.loadTextureFile(t,function(e,t,a,n){if(!e)return void(i&&i());let r={data:new Uint8Array(e),width:a,height:n};o.format=THREE.RGBAFormat,o.image=r,o.needsUpdate=!0}),o)}t.exports={buildVS:n,generateDataTexture:r,buildPS:i,getUVMat:o,getMaterial:function(e,t,a,n){if(!t)return;let r,i=t.getChunk("dx9s"),o=t.getChunk("grmt"),s=[];if(e&&e.textures.length){let t,r,d=i.data.techniques[0].passes[0].effects[0],f=[];for(let a=0;a<d.samplerIndex.length;a++){let n=d.samplerIndex[a],l=i.data.samplers[n];if(l)if((t=l&&o.data.texTokens[l.textureIndex])||(t="0-0"),r=null,e.textures.forEach(function(e){r||e.token.split("-")[0]!==t.split("-")[0]||(r=e)}),r)f.push(r);else if(l)f.push(e.textures[l.textureIndex]);else{if(!(e.textures.length>0))return;f.push(e.textures[0])}}if(f.length<=0)return;f.forEach(function(e,t){if(!e)return;let r=e&&e.filename;s[t]=l(r,a,n),s[t]&&(s[t].uvIdx=e.uvPSInputIndex)})}if(s){let t=!1,i=!1;if(e.textures.forEach(function(e){t||"1733499172"!==e.token.split("-")[0]||(t=e),i||"404146670"!==e.token.split("-")[0]||(i=e)}),!t||t.filename<=0)return;if(r=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:l(t.filename,a,n)}),i){let e=l(i.filename,a,n);e.flipY=!0,r.normalMap=e}r.textureFilename=t.filename,16460!==o.data.flags&&(r.alphaTest=.05)}else r=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});if(r.needsUpdate=!0,e){let a=1,n=16;o=t.getChunk("grmt"),e.materialFlags&a||e.materialFlags&n||e.materialFlags;let i=8;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(o.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",o.data.flags),o.data.flags&i||(r=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:r.map})),16460!==o.data.flags&&(r.alphaTest=.05)}return r},loadLocalTexture:s}},{}],20:[function(e,t,a){const n=Math.pow(2,32);t.exports={f16:function(e){let t=(32768&e)>>15,a=(31744&e)>>10,n=1023&e;return 0===a?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31===a?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,a-15)*(1+n/Math.pow(2,10))},popcount:function(e){return e=(252645135&(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459)))+(e>>4&252645135),(e+=e>>8)+(e>>15)&63},arr32To64:function(e){return n*e[1]+e[0]},sort_unique:function(e,t){let a=Array.prototype.sort.call(e,t),n={},r=[];for(let e=0,t=a.length;e<t;++e)n.hasOwnProperty(a[e])||(r.push(a[e]),n[a[e]]=1);return r}}},{}],21:[function(e,t,a){t.exports={getArrayReader:function(e,t){return function(a,n){let r=[];try{let i=a.readUint32(),o=a.readUint32();if(0===o)return r;let l=a.position-4+o,s=a.position;if(t&&i>t)throw"Array length "+i+" exceeded allowed maximum "+t;a.seek(l),r=a.readType(["[]",e,i],n),a.seek(s)}catch(t){console.warn("getArrayReader Failed loading array",t),console.warn("getArrayReader Failed loading array, structDef",e)}return r}},getRefArrayReader:function(e){return function(t){let a=[],n=t.readUint32(),r=t.position+t.readUint32();if(0===n)return a;let i=t.position;t.seek(r);let o=t.readInt32Array(n),l=i-4;t.seek(l),l+=t.readUint32();for(let n=0;n<o.length;n++)if(0!==o[n]){let r=l+4*n+o[n];t.seek(r);try{a.push(t.readStruct(e))}catch(e){a.push(null),console.warn("getRefArrayReader could not find refered data at offset",o[n],e)}}return t.seek(i),a}},getQWordReader:function(){return function(e){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e){let t=e.position+e.readUint32(),a=e.position;e.seek(t);let n=e.readCString();return e.seek(a),n}},getString16Reader:function(e){return function(t){let a=t.position+t.readUint32()+(e||0),n=t.position;t.seek(a);let r,i="";for(;t.position+2<t.byteLength&&0!==(r=t.readUint16());)i+=String.fromCharCode(r);return t.seek(n),i}},getPointerReader:function(e){return function(t){let a=t.readUint32();if(0===a)return{};let n=t.position-4+a,r=t.position;t.seek(n);let i=t.readStruct(e);return t.seek(r),i}},getFileNameReader:function(){return function(e){let t;try{let a=e.position+e.readUint32();t=e.position,e.seek(a);let n=e.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),r=65280*(n.m_highPart-256)+(n.m_lowPart-256)+1;return r<0&&(r=0),e.seek(t),r}catch(a){return e.seek(t),-1}}}}},{}],22:[function(e,t,a){const n=e("../format/file/GW2File"),r=e("./MaterialUtils"),i=e("./MathUtils");let o={},l={Position:1,Weights:2,Group:4,Normal:8,Color:16,Tangent:32,Bitangent:64,TangentFrame:128,UV32Mask:65280,UV16Mask:16711680,Unknown1:16777216,Unknown2:33554432,Unknown3:67108864,Unknown4:134217728,PositionCompressed:268435456,Unknown5:536870912};function s(e,t,a,n,s){let d=t.data.meshes,f=[],m=a.data.permutations[0].materials;return d.forEach(function(t){let d=t.geometry,u=d.verts.mesh.fvf,h=d.verts.vertexCount,c=d.verts.mesh.vertices,g=d.indices.indices,p=new THREE.BufferGeometry,T=new DataStream(c.buffer),E=c.length/h,R=new Float32Array(3*h),y=[],N=12*!!(u&l.Position)+4*!!(u&l.Weights)+4*!!(u&l.Group)+12*!!(u&l.Normal)+4*!!(u&l.Color)+12*!!(u&l.Tangent)+12*!!(u&l.Bitangent)+12*!!(u&l.TangentFrame),x=(u&l.UV32Mask)>>8,v=(u&l.UV16Mask)>>16,M=!!x,k=!!v||!!x,b=M?x:v,w=i.popcount(b);if(w=Math.min(w,1),k)for(let e=0;e<w;e++)y[e]=new Float32Array(2*h);l.Normal,l.Tangent,l.Bitangent,l.TangentFrame;for(let e=0;e<h;e++){T.seek(e*E);let t=T.readFloat32(),a=T.readFloat32(),n=T.readFloat32();if(R[3*e+0]=t,R[3*e+1]=-n,R[3*e+2]=-a,k)for(let t=0;t<w;t++){let a,n;T.seek(e*E+N+t*(M?8:4)),M?(a=T.readUint32(),n=T.readUint32()):(a=i.f16(T.readUint16()),n=i.f16(T.readUint16())),y[t][2*e+0]=a,y[t][2*e+1]=n}}let F=new Uint16Array(g.length);for(let e=0;e<g.length;e+=3)F[e+0]=g[e+2],F[e+1]=g[e+1],F[e+2]=g[e+0];if(p.addAttribute("position",new THREE.BufferAttribute(R,3)),p.setIndex(new THREE.BufferAttribute(F,1)),p.computeVertexNormals(),k){for(let e=0;e<w;e++){let t="uv"+(e>0?e+1:"");p.addAttribute(t,new THREE.BufferAttribute(y[e],2)),p.attributes[t].needsUpdate=!0}p.uvsNeedUpdate=!0}p.buffersNeedUpdate=!0;let D=t.materialIndex,S=m[D],L=null;S&&o[S.filename]&&(L=o[S.filename]);let A=r.getMaterial(S,L,e,n);if(!A){if(!s)return;A=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}let C=new THREE.Mesh(p,A);S&&(C.materialFlags=S.materialFlags,C.materialFilename=S.filename),C.materialName=t.materialName,C.numLods=t.geometry.lods.length,C.lodOverride=a.data.lodOverride,C.flags=t.flags,C.numUV=w,f.push(C)}),f}function d(e,t,a,r,i,l){let d=[];a.loadFile(e,function(t){try{if(!t)throw"Could not find MFT entry for "+e;let f=new DataStream(t),m=new n(f,0),u=m.getChunk("modl"),h=m.getChunk("geom"),c=u.data.boundingSphere,g=c.center;c.radius+=Math.sqrt(g[0]*g[0]+Math.sqrt(g[1]*g[1]+g[2]*g[2]));let p=u.data.permutations[0].materials;!function e(t,r){if(t>=p.length)return void r();let i=p[t];o[i.filename]?e(t+1,r):a.loadFile(i.filename,function(a){if(a){let e=new DataStream(a),t=new n(e,0);o[i.filename]=t}e(t+1,r)})}(0,function(){s(a,h,u,r,i).forEach(function(e){[0,8,9,520,2056,2057,2060,2061,2312,2316,2568,2569,2572,2573,2584,2824,2828,2840,4617,6664].indexOf(e.materialFlags),e.materialFlags,(i||2056&e.materialFlags)&&(4===e.flags||1===e.flags||e.flags,d.push(e))}),l(d,c)})}catch(t){console.warn("Failed rendering model "+e,t);let a=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);a.flags=4,a.materialFlags=2056,a.lodOverride=[1e6,1e6],d.push(a),l(d)}})}t.exports={renderRect:function(e,t,a,n){let r=e.x1-e.x2,i=e.y1-e.y2;n||(n=1);let o=(e.x1+e.x2)/2,l=(e.y1+e.y2)/2,s=t,d=new THREE.BoxGeometry(r,n,i);a=a||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});let f=new THREE.Mesh(d,a);return f.overdraw=!0,f.position.x=o,f.position.y=s,f.position.z=l,f},loadLocalTexture:function(e,t,a,n,i){return T3D.Logger.log(T3D.Logger.TYPE_WARNING,"RenderUtils.loadLocalTexture is deprecated ! Please use the one from MaterialUtils."),r.loadLocalTexture(e,t,a,n,i)},renderGeomChunk:s,loadMeshFromModelFile:d,getMeshesForFilename:function(e,t,a,n,r,i,o){n[e]?o(n[e].meshes,!0,n[e].boundingSphere):d(e,0,a,r,i,function(t,a){t&&(n[e]={meshes:t,boundingSphere:a}),o(t,!1,a)})},getFilesUsedByModel:function(e,t,a){let r=[e];t.loadFile(e,function(t){try{if(!t)throw"Could not find MFT entry for "+e;let a=new DataStream(t);new n(a,0).getChunk("modl").data.permutations[0].materials.forEach(function(e){let t=e.filename;r.push(t),e.textures.forEach(function(e){r.push(e.filename)})})}catch(e){console.warn("Could not export any data",e)}a(r)})}}},{"../format/file/GW2File":18,"./MaterialUtils":19,"./MathUtils":20}],23:[function(e,t,a){t.exports={getFragmentShader:function(){return["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},getVertexShader:function(){return["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}}},{}]},{},[8])(8)});
//# sourceMappingURL=T3D-1.1.0.js.map
