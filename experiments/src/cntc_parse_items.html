<html>
  <head>
    <title>cntc chunk analysis</title>
    <meta content="" />
    <style></style>
  </head>

  <body>
    <label>
      <input id="filePicker" type="file" />
    </label>
    <script src="./static/jquery.js"></script>
    <script src="./static/DataStream.js"></script>
    <script src="./static/T3D.js"></script>
    <script>
      var lr;
      $("#filePicker").change(function (evt) {
        var file = evt.target.files[0];
        T3D.getLocalReader(
          file,
          async function (lr) {
            //We target a specific file:
            const cntcFile = 473992;

            let archiveFile = await lr.readFile(cntcFile, false, false, undefined, undefined, true);
            let file = new T3D.GW2File(new DataStream(archiveFile.buffer), 0);
            let mainChunk = file.getChunk("Main").data;

            console.log("File loaded");

            let entryArray = [];

            const entriesAmount = mainChunk.indexEntries.length;
            for (let i = 0; i < entriesAmount; i++) {
              let begin = mainChunk.indexEntries[i].offset;
              let end = mainChunk.indexEntries[i + 1] ? mainChunk.indexEntries[i + 1].offset : mainChunk.content.length;
              let contentSlice = mainChunk.content.slice(begin, end);
              let entry = {
                type: mainChunk.indexEntries[i].type,
                rootIndex: mainChunk.indexEntries[i].rootIndex,
                contentSlice: contentSlice,
              };
              entryArray.push(entry);
            }

            console.log(entryArray);
          },
          "./static/t3dworker.js"
        );
      });
    </script>
  </body>
</html>
